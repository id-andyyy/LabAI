---
name: lab-setup
description: Настройка проекта — конфигурация, парсинг задания, подготовка окружения
---

Пользователь хочет настроить проект для выполнения лабораторной работы. Нужно проверить окружение, собрать данные о студенте и работе, распарсить задание и сохранить всё в config.json.

## Что делать

### Шаг 1. Проверка Python

Проверь наличие Python:
1. Выполни `python3 --version` (если не найден — попробуй `python --version`).
2. Если Python найден — запомни путь (например, `python3`).
3. Если Python не найден — сообщи пользователю, что генерация DOCX/PDF не будет работать, а парсинг PDF/DOCX потребует ручного ввода текста. Продолжай настройку.

### Шаг 2. Создание venv и установка зависимостей

Если Python найден:
1. Создай виртуальное окружение: `python3 -m venv .claude/lab/venv`
2. Установи зависимости: `.claude/lab/venv/bin/pip install -r .claude/lab/scripts/requirements.txt`
3. На Windows пути через `Scripts/` вместо `bin/`.

Если Python не найден — пропусти этот шаг.

### Шаг 3. Опрос пользователя

Если config.json уже существует (.claude/lab/config.json) — прочитай его, покажи текущие значения и спроси, хочет ли пользователь что-то изменить. Если хочет — задай только те вопросы, которые нужно обновить.

Если config.json не существует — задай все вопросы через AskUserQuestion (разбей на блоки по 4 вопроса максимум):

**Блок 1 — студент и учебное заведение:**
1. ФИО студента.
2. Группа студента.
3. Полное название учебного заведения (как на титульном листе).
4. Город.

**Блок 2 — предмет и работа:**
1. Название предмета/курса.
2. Номер лабораторной работы.
3. Название лабораторной работы (или пусто — определим из задания).
4. ОС пользователя (Windows / macOS / Linux — с версией, если знает).

**Блок 3 — предпочтения:**
1. Формат итогового отчёта: docx / pdf / md.
2. Имя итогового файла (без расширения). По умолчанию — `report`. Примеры: `Лабораторная_работа_3`, `ЛР3_Иванов`.
3. Стиль отчёта: первое лицо («я выполнил, я настроил») / безличное («было выполнено, было настроено»).
4. Нужно ли дополнительное исследование в отчёте? (Да / Нет)

### Шаг 4. Поиск и парсинг задания

1. Поищи файлы задания в корне проекта: `*.pdf`, `*.docx`, `*.txt`, `*.md` (исключая CLAUDE.md, README.md, report.md, instructions.md).
2. Также проверь наличие изображений задания: `*.png`, `*.jpg`, `*.jpeg` (фото/скан задания).
3. Если найдено несколько кандидатов — спроси пользователя, какой файл содержит задание.
4. Если файл не найден — попроси пользователя положить файл задания в корень проекта (рекомендуемое имя: `task.pdf`, `task.docx`, `task.txt` или `task.md`) и повтори поиск.

**Парсинг:**
- Если есть venv и файл PDF/DOCX — запусти: `.claude/lab/venv/bin/python .claude/lab/scripts/parse_assignment.py <файл>`
- Если файл TXT/MD — прочитай через Read tool.
- Если файл — изображение (PNG/JPG) — прочитай через Read tool (vision), извлеки текст.
- Если Python не установлен, а файл PDF/DOCX — попроси пользователя скопировать текст задания в чат или в файл task.txt.

Сохрани разобранный текст в `.claude/lab/assignment.md`.

### Шаг 5. Анализ задания + уточняющие вопросы

1. Прочитай `.claude/lab/assignment.md`.
2. Определи тип лабораторной работы:
   - `practical` — практическая (настройка ПО, сети, выполнение действий на компьютере)
   - `theoretical` — теоретическая (анализ, описание, сравнение)
   - `programming` — программирование (написание кода)
   - `calculation` — расчётная (вычисления, формулы)
3. Если название ЛР не было указано пользователем — извлеки из текста задания.
4. Если задание требует специфических данных (версии ПО, сетевые настройки, конфигурация системы и т.д.) — задай уточняющие вопросы. Полученные данные сохрани в `config.system.additional_info`.

### Шаг 6. Шаблон титульного листа

Спроси пользователя:
- Есть ли готовый шаблон Word-документа с титульным листом (template.docx)?
- Если да — попроси положить его в `.claude/lab/templates/template.docx`.
- Если нет — титульный лист будет сгенерирован автоматически из данных конфигурации.

### Шаг 7. Определение workflow

Спроси пользователя: нужна ли пошаговая инструкция (instructions.md), или сразу перейти к черновику отчёта?

Подсказка:
- Если тип работы `practical` — рекомендуй инструкцию (`/lab-instructions`).
- Если тип `theoretical`, `programming` или `calculation` — рекомендуй сразу черновик (`/lab-draft`).

### Шаг 8. Сохранение config.json

Сохрани все собранные данные в `.claude/lab/config.json`:

```json
{
  "student": {
    "name": "ФИО студента",
    "group": "Группа"
  },
  "institution": {
    "name": "Полное название учебного заведения",
    "city": "Город"
  },
  "course": {
    "name": "Название предмета",
    "lab_number": 1,
    "lab_title": "Название лабораторной работы"
  },
  "preferences": {
    "report_format": "docx",
    "output_filename": "report",
    "report_style": "first_person",
    "needs_research": false,
    "needs_instructions": true
  },
  "system": {
    "os": "ОС пользователя",
    "python_path": "python3",
    "venv_python": ".claude/lab/venv/bin/python",
    "additional_info": {}
  },
  "template": {
    "has_custom_template": false,
    "template_path": null
  },
  "assignment": {
    "original_file": "task.pdf",
    "parsed_file": ".claude/lab/assignment.md",
    "type": "practical"
  }
}
```

Значения `report_style`: `"first_person"` (я выполнил) или `"impersonal"` (было выполнено).
Если Python не установлен: `python_path` и `venv_python` = `null`.

### Шаг 9. Итог

Покажи пользователю итоговую конфигурацию в читаемом виде. Затем сообщи, что делать дальше:
- Если `needs_instructions` = true → «Следующий шаг: `/lab-instructions`»
- Если `needs_instructions` = false → «Следующий шаг: `/lab-draft`»

## Дополнительный контекст от пользователя

$ARGUMENTS
